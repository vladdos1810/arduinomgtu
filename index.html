<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Управление Arduino</title>
    <style>
        body { font-family: Arial; margin: 20px; }
        .btn { padding: 10px; margin: 5px; color: white; border: none; border-radius: 5px; }
        .on { background: green; }
        .off { background: red; }
    </style>
</head>
<body>
    <h1>Управление Arduino</h1>
    
    <div>
        <h3>Введите IP адрес Arduino:</h3>
        <input type="text" id="ipInput" value="192.168.3.17">
        <button onclick="saveIP()">Сохранить IP</button>
        <p id="currentIP">Текущий IP: 192.168.3.17</p>
    </div>

    <div id="controls">
        <p>Сначала настройте IP адрес</p>
    </div>

    <script>
    let arduinoIP = '192.168.3.17';

    function saveIP() {
        const newIP = document.getElementById('ipInput').value;
        if (newIP) {
            arduinoIP = newIP;
            document.getElementById('currentIP').textContent = 'Текущий IP: ' + newIP;
            createControls();
        }
    }

    function createControls() {
        const controls = document.getElementById('controls');
        controls.innerHTML = '';
        
        for (let i = 1; i <= 4; i++) {
            controls.innerHTML += `
                <div>
                    <h3>Светодиод ${i}</h3>
                    <button class="btn on" onclick="controlLed(${i}, 'on')">ВКЛ</button>
                    <button class="btn off" onclick="controlLed(${i}, 'off')">ВЫКЛ</button>
                    <span id="status${i}">❌ ВЫКЛ</span>
                </div>
            `;
        }
    }

    async function controlLed(ledNumber, action) {
        try {
            // Пробуем разные варианты URL
            const urls = [
                `http://${arduinoIP}/led${ledNumber-1}${action}`,
                `http://${arduinoIP}/led${ledNumber}${action}`,
                `http://${arduinoIP}:80/led${ledNumber-1}${action}`
            ];
            
            let success = false;
            for (let url of urls) {
                try {
                    const response = await fetch(url);
                    if (response.ok) {
                        document.getElementById(`status${ledNumber}`).textContent = 
                            action === 'on' ? '✅ ВКЛ' : '❌ ВЫКЛ';
                        success = true;
                        break;
                    }
                } catch (e) {}
            }
            
            if (!success) {
                alert('Не удалось подключиться к Arduino. Проверьте:\n1. IP адрес\n2. Подключение к сети\n3. Настройки роутера');
            }
            
        } catch (error) {
            alert('Ошибка подключения: ' + error.message);
        }
    }

    // Создаем элементы управления при загрузке
    window.onload = createControls;
    </script>
</body>
</html>
